# Generated DigitalOcean App Platform Specification
# Generated: 2025-08-10T00:44:21Z
# Environment: production
# Repository: dzp5103/Spotify-echo
# 
# SECURITY NOTICE: This spec contains NO secrets or API keys
# All sensitive environment variables must be set in the DigitalOcean UI
#
# Required Environment Variables (set in DO UI):
# - SPOTIFY_CLIENT_ID (required)
# - SPOTIFY_CLIENT_SECRET (required)  
# - SPOTIFY_REDIRECT_URI (required)
# - OPENAI_API_KEY (required)
# - MONGODB_URI (required)
# - SESSION_SECRET (required - generate random string)
# - JWT_SECRET (required - generate random string)
#
# Optional Environment Variables:
# - GEMINI_API_KEY (alternative AI provider)
# - LLM_PROVIDER (defaults to 'openai')
# - REDIS_URL (for caching and sessions)
# - BROWSERBASE_API_KEY (for browser automation)
# - BROWSERBASE_PROJECT_ID (for browser automation)

# DigitalOcean App Platform Template for EchoTune AI
# PRODUCTION-READY DEPLOYMENT (No demo/mock configurations)
# Documentation: https://docs.digitalocean.com/products/app-platform/how-to/add-deploy-do-button/
#
# SECURITY: This template requires environment variables to be set in DigitalOcean UI
# DO NOT include any secrets or API keys in this file

spec:
  name: echotune-ai
  region: nyc1
  
  services:
  - name: web
    source_dir: /
    
    # Source configuration
    github:
      repo: dzp5103/Spotify-echo
      branch: main
      deploy_on_push: true
    
    # Build configuration
    build_command: npm ci --only=production && npm run build
    run_command: npm start
    
    # Runtime settings
    environment_slug: node-js
    instance_count: 1
    instance_size_slug: professional-xs
    
    # Network configuration
    http_port: 3000
    
    # Health monitoring
    health_check:
      http_path: /health
      initial_delay_seconds: 60
      period_seconds: 10
      timeout_seconds: 5
      success_threshold: 1
      failure_threshold: 3
    
    # Production environment variables (NO SECRETS - Set these in DO UI)
    envs:
    - key: NODE_ENV
      value: production
    - key: PORT
      value: "3000"
    - key: HEALTH_CHECK_ENABLED
      value: "true"
    - key: METRICS_ENABLED
      value: "true" 
    - key: CHAT_ENABLED
      value: "true"
    - key: TRUST_PROXY
      value: "true"
    - key: LOG_LEVEL
      value: info
    - key: SESSION_SECURE
      value: "true"
    
    # REQUIRED: Set these in DigitalOcean App Platform UI under Environment Variables
    # - SPOTIFY_CLIENT_ID (required for Spotify integration)
    # - SPOTIFY_CLIENT_SECRET (required for Spotify integration) 
    # - SPOTIFY_REDIRECT_URI (required for OAuth callback)
    # - OPENAI_API_KEY (required for AI chat features)
    # - GEMINI_API_KEY (optional - alternative AI provider)
    # - LLM_PROVIDER (openai or gemini - defaults to openai)
    # - MONGODB_URI (required for data persistence)
    # - REDIS_URL (optional - for caching and session storage)
    # - SESSION_SECRET (required - generate a secure random string)
    # - JWT_SECRET (required - generate a secure random string)
    # - BROWSERBASE_API_KEY (optional - for browser automation)
    # - BROWSERBASE_PROJECT_ID (optional - for browser automation)
    
    # Routing
    routes:
    - path: /
      
  # Optional: Database services (uncomment if not using external services)
  # databases:
  # - name: echotune-db
  #   engine: PG
  #   version: "13"
  #   size: db-s-dev-database
  
  # Optional: Static site service for documentation
  # static_sites:
  # - name: docs
  #   source_dir: /docs
  #   github:
  #     repo: dzp5103/Spotify-echo
  #     branch: main
  #   build_command: npm run build:docs
  #   output_dir: /docs/build
  
# Alerts and monitoring
alerts:
- rule: CPU_UTILIZATION
  value: 80
- rule: MEM_UTILIZATION  
  value: 80
- rule: RESTART_COUNT
  value: 5
