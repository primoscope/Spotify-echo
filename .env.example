(cd "$(git rev-parse --show-toplevel)" && git apply --3way <<'EOF'
diff --git a/.env.template b/.env.template
--- a/.env.template
+++ b/.env.template
@@ -1,140 +1,547 @@
-# E=choT=une A=I P=roduction E=nvironment C=onfiguration
-# O=ptimized for quick deployment with SS=L and security hardening
-# C=opy this to .env and update with your actual values
-
-# =============================================================================
-# ðŸš€ QUIC=K DEPLOYMEN=T SETTING=S
-# =============================================================================
-
-# D=omain C=onfiguration (REQUIRE=D for production)
-DOMAI=N=your-domain.com
-FRONTEND_UR=L=https://your-domain.com
-NODE_EN=V=production
-POR=T=3000
-
-# S=potify AP=I C=onfiguration (REQUIRE=D)
-# G=et these from https://developer.spotify.com/dashboard
-SPOTIFY_CLIENT_I=D=your_=spotify_=client_=id_=here
-SPOTIFY_CLIENT_SECRE=T=your_=spotify_=client_=secret_=here
-SPOTIFY_REDIRECT_UR=I=https://primosphere.studio/auth/callback
-SPOTIFY_PRODUCTION_REDIRECT_UR=I=https://your-domain.com/auth/callback
-
-# S=potify L=ogin C=redentials (for testing - replace with your own)
-# U=sername: your_=spotify_=username
-# P=assword: your_=spotify_=password
-
-# =============================================================================
-# ðŸ” ENHANCE=D SECURIT=Y CONFIGURATIO=N
-# =============================================================================
-
-# S=ecurity S=ecrets (GENERAT=E NE=W I=N PRODUCTIO=N)
-# G=enerate with: openssl rand -hex 32
-SESSION_SECRE=T=generate_=new_=secret_=here_=using_=openssl_=rand_=hex_=32
-JWT_SECRE=T=generate_=new_=secret_=here_=using_=openssl_=rand_=hex_=32
-
-# SS=L/TL=S C=onfiguration
-SSL_CERT_PAT=H=/etc/nginx/ssl/your-domain.com.crt
-SSL_KEY_PAT=H=/etc/nginx/ssl/your-domain.com.key
-LETSENCRYPT_EMAI=L=admin@your-domain.com
-ENABLE_HST=S=true
-FORCE_HTTP=S=true
-
-# E=nhanced S=ecurity H=eaders
-ENABLE_SECURITY_HEADER=S=true
-CSP_ENABLE=D=true
-CSP_REPORT_ONL=Y=false
-
-# =============================================================================
-# ðŸš„ PERFORMANC=E & OPTIMIZATIO=N
-# =============================================================================
-
-# C=aching C=onfiguration
-ENABLE_REDI=S=true
-REDIS_UR=L=redis://localhost:6379
-REDIS_PASSWOR=D=your_=redis_=password
-CACHE_TT=L=3600
-
-# D=atabase C=onfiguration
-MONGODB_UR=I=mongodb+srv://copilot:D=apperM=an77@cluster0.ofnyuy.mongodb.net/echotune?retryW=rites=true&w=majority&appN=ame=C=luster0
-MONGODB_URI_PRO=D=mongodb+srv://username:password@cluster.mongodb.net/echotune_=ai
-SUPABASE_UR=L=https://your-project.supabase.co
-SUPABASE_ANON_KE=Y=your_=supabase_=anon_=key
-
-# =============================================================================
-# ðŸ¤– A=I/M=L PROVIDE=R CONFIGURATIO=N
-# =============================================================================
-
-# P=rimary LL=M P=rovider (openai, gemini, openrouter, mock)
-LLM_PROVIDE=R=openai
-
-# O=penA=I C=onfiguration
-OPENAI_API_KE=Y=sk-your_=openai_=api_=key_=here
-OPENAI_MODE=L=gpt-4o-mini
-OPENAI_MAX_TOKEN=S=1000
-
-# G=oogle G=emini C=onfiguration
-GEMINI_API_KE=Y=your_=gemini_=api_=key_=here
-GEMINI_MODE=L=gemini-2.0-flash-exp
-
-# O=penR=outer C=onfiguration (for C=laude, etc.)
-OPENROUTER_API_KE=Y=your_=openrouter_=api_=key_=here
-
-# =============================================================================
-# ðŸ”§ MC=P SERVE=R CONFIGURATIO=N
-# =============================================================================
-
-# MC=P S=erver P=ort
-MCP_SERVER_POR=T=3001
-
-# B=rowserbase C=onfiguration (for browser automation)
-BROWSERBASE_API_KE=Y=your_=browserbase_=api_=key
-BROWSERBASE_PROJECT_I=D=your_=browserbase_=project_=id
-
-# =============================================================================
-# ðŸ“Š MONITORIN=G & ANALYTIC=S
-# =============================================================================
-
-# A=pplication M=onitoring
-ENABLE_ANALYTIC=S=true
-ANALYTICS_ENDPOIN=T=https://analytics.your-domain.com
-
-# H=ealth C=heck C=onfiguration
-HEALTH_CHECK_ENABLE=D=true
-HEALTH_CHECK_INTERVA=L=30000
-
-# =============================================================================
-# ðŸš€ DEPLOYMEN=T & DEVOP=S
-# =============================================================================
-
-# D=igitalO=cean C=onfiguration
-DO_ACCESS_TOKE=N=your_=digitalocean_=access_=token_=here
-DO_SPACES_KE=Y=your_=do_=spaces_=key
-DO_SPACES_SECRE=T=your_=do_=spaces_=secret
-DO_REGISTRY_TOKE=N=your_=do_=registry_=token
-
-# D=ocker C=onfiguration
-DOCKER_REGISTR=Y=registry.digitalocean.com
-DOCKER_IMAGE_NAM=E=echotune-ai
-
-# G=itH=ub C=onfiguration (for C=I/C=D)
-GITHUB_TOKE=N=your_=github_=token
-
-# =============================================================================
-# ðŸ§ª DEVELOPMEN=T & TESTIN=G
-# =============================================================================
-
-# D=evelopment S=ettings
-DEBU=G=false
-VERBOSE_LOGGIN=G=false
-ENABLE_COR=S=true
-
-# T=esting C=onfiguration
-TEST_SPOTIFY_USE=R=your_=test_=spotify_=username
-TEST_SPOTIFY_PAS=S=your_=test_=spotify_=password
-
-# =============================================================================
-# ðŸ¤– MC=P (M=odel C=ontext P=rotocol) CONFIGURATIO=N
-# =============================================================================
-
-# MC=P
-MCP_POR=T=3001
+# E=choT=une A=I P=roduction E=nvironment C=onfiguration
+
+# K=eep this file committed. C=opy to `.env` and fill real values locally or in your secret manager.
+
+# =============================================================================
+
+# QU=I=C=K DEPLOYM=E=N=T SETTI=N=G=S
+
+# =============================================================================
+
+DOM=A=I=N=primosphere.studio
+
+FRONTEND_=U=R=L=https://primosphere.studio
+
+NODE_=E=N=V=production
+
+P=O=R=T=3000
+
+# =============================================================================
+
+# SPOT=I=F=Y A=P=I CONFIGURAT=I=O=N
+
+# =============================================================================
+
+SPOTIFY_CLIEN=T_=I=D=CHANGE_ME_SPOTIFY_CLIEN=T_=I=D
+
+SPOTIFY_CLIENT_SEC=R=E=T=CHANGE_ME_SPOTIFY_CLIENT_SEC=R=E=T
+
+SPOTIFY_REDIRECT_=U=R=I=https://primosphere.studio/auth/callback
+
+SPOTIFY_PRODUCTION_REDIRECT_=U=R=I=https://primosphere.studio/auth/callback
+
+# =============================================================================
+
+# SECUR=I=T=Y SECR=E=T=S
+
+# =============================================================================
+
+SESSION_SEC=R=E=T=CHANGE_ME_RAND=O=M_=64_CH=A=R=S
+
+JWT_SEC=R=E=T=CHANGE_ME_RAND=O=M_=64_CH=A=R=S
+
+# =============================================================================
+
+# S=S=L/T=L=S CONFIGURAT=I=O=N
+
+# =============================================================================
+
+SSL_CERT_P=A=T=H=/etc/nginx/ssl/primosphere.studio.crt
+
+SSL_KEY_P=A=T=H=/etc/nginx/ssl/primosphere.studio.key
+
+LETSENCRYPT_EM=A=I=L=admin@primosphere.studio
+
+ENABLE_H=S=T=S=true
+
+FORCE_HT=T=P=S=true
+
+# =============================================================================
+
+# SECUR=I=T=Y HEAD=E=R=S
+
+# =============================================================================
+
+ENABLE_SECURITY_HEAD=E=R=S=true
+
+CSP_ENAB=L=E=D=true
+
+CSP_REPORT_O=N=L=Y=false
+
+# =============================================================================
+
+# PERFORMA=N=C=E & OPTIMIZAT=I=O=N
+
+# =============================================================================
+
+API_RATE_LI=M=I=T=10r/s
+
+AUTH_RATE_LI=M=I=T=5r/m
+
+GENERAL_RATE_LI=M=I=T=20r/s
+
+RATE_LIMIT_WINDO=W_=M=S=900000
+
+RATE_LIMIT_MAX_REQUE=S=T=S=100
+
+MAX_REQUEST_S=I=Z=E=10mb
+
+COMPRESS=I=O=N=true
+
+GZIP_ENAB=L=E=D=true
+
+KEEP_ALIVE_TIME=O=U=T=65000
+
+HEADERS_TIME=O=U=T=66000
+
+CACHE_ENAB=L=E=D=true
+
+CACHE_=T=T=L=3600
+
+SPOTIFY_API_CACHE_=T=T=L=300
+
+STATIC_CACHE_=T=T=L=86400
+
+# =============================================================================
+
+# DATAB=A=S=E CONFIGURAT=I=O=N
+
+# =============================================================================
+
+# M=ongoD=B
+
+MONGODB_=U=R=I=mongodb+srv://copilot:D=apperM=an77@cluster0.ofnyuy.mongodb.net/echotune?retryW=rites=true&w=majority&appN=ame=C=luster0
+
+MONGODB_DATAB=A=S=E=echotune
+
+MONGODB_ROOT_U=S=E=R=CHANGE_ME_MONGO_ROOT_U=S=E=R
+
+MONGODB_ROOT_PASSW=O=R=D=CHANGE_ME_MONGO_ROOT_PASSW=O=R=D
+
+# R=edis
+
+REDIS_=U=R=L=redis://localhost:6379
+
+REDIS_PASSW=O=R=D=CHANGE_ME_REDIS_PASSW=O=R=D
+
+# F=allback
+
+DATABASE_T=Y=P=E=mongodb
+
+ENABLE_SQLITE_FALLB=A=C=K=true
+
+# =============================================================================
+
+# A=I & L=L=M PROVID=E=R=S
+
+# =============================================================================
+
+DEFAULT_LLM_PROVI=D=E=R=gemini
+
+DEFAULT_LLM_MO=D=E=L=gemini-2.0-flash
+
+# G=oogle G=emini
+
+GEMINI_API_=K=E=Y=${GEMINI_API_=K=E=Y:-}
+
+GEMINI_MO=D=E=L=gemini-2.0-flash
+
+GEMINI_TEMPERAT=U=R=E=0.7
+
+GEMINI_MAX_TOK=E=N=S=4096
+
+# O=penA=I
+
+OPENAI_API_=K=E=Y=${OPENAI_API_=K=E=Y:-}
+
+OPENAI_MO=D=E=L=gpt-3.5-turbo
+
+OPENAI_TEMPERAT=U=R=E=0.7
+
+OPENAI_MAX_TOK=E=N=S=4096
+
+# A=zure O=penA=I
+
+AZURE_OPENAI_API_=K=E=Y=${AZURE_OPENAI_API_=K=E=Y:-}
+
+AZURE_OPENAI_ENDPO=I=N=T=${AZURE_OPENAI_ENDPO=I=N=T:-}
+
+AZURE_OPENAI_DEPLOYMENT_N=A=M=E=${AZURE_OPENAI_DEPLOYMENT_N=A=M=E:-}
+
+# O=penR=outer (optional)
+
+OPENROUTER_API_=K=E=Y=${OPENROUTER_API_=K=E=Y:-}
+
+# =============================================================================
+
+# MONITOR=I=N=G & LOGG=I=N=G
+
+# =============================================================================
+
+LOG_LE=V=E=L=info
+
+LOG_F=I=L=E=/opt/echotune/logs/app.log
+
+ACCESS_LOG_F=I=L=E=/opt/echotune/logs/access.log
+
+ERROR_LOG_F=I=L=E=/opt/echotune/logs/error.log
+
+LOG_ROTAT=I=O=N=daily
+
+LOG_MAX_S=I=Z=E=100mb
+
+LOG_MAX_FI=L=E=S=7
+
+HEALTH_CHECK_ENAB=L=E=D=true
+
+HEALTH_CHECK_INTER=V=A=L=30000
+
+METRICS_ENAB=L=E=D=true
+
+PERFORMANCE_MONITOR=I=N=G=true
+
+UPTIME_MONITOR=I=N=G=true
+
+RESPONSE_TIME_THRESH=O=L=D=5000
+
+CPU_THRESH=O=L=D=80
+
+MEMORY_THRESH=O=L=D=85
+
+DISK_THRESH=O=L=D=90
+
+SENTRY_=D=S=N=${SENTRY_=D=S=N:-}
+
+GOOGLE_ANALYTIC=S_=I=D=${GOOGLE_ANALYTIC=S_=I=D:-}
+
+# =============================================================================
+
+# NETW=O=R=K & PR=O=X=Y
+
+# =============================================================================
+
+TRUST_PR=O=X=Y=true
+
+PROXY_TIME=O=U=T=30000
+
+BEHIND_REVERSE_PR=O=X=Y=true
+
+# C=O=R=S
+
+ENABLE_C=O=R=S=true
+
+CORS_ORIG=I=N=S=https://primosphere.studio,https://www.primosphere.studio
+
+CORS_CREDENTI=A=L=S=true
+
+# W=ebS=ocket
+
+WEBSOCKET_ENAB=L=E=D=true
+
+WEBSOCKET_P=A=T=H=/socket.io
+
+WEBSOCKET_TRANSPO=R=T=S=websocket,polling
+
+# =============================================================================
+
+# SPOT=I=F=Y SETTI=N=G=S
+
+# =============================================================================
+
+SPOTIFY_MAR=K=E=T=U=S
+
+SPOTIFY_LOC=A=L=E=en_=U=S
+
+SPOTIFY_SCO=P=E=S=user-read-private,user-read-email,user-top-read,user-read-recently-played,playlist-read-private,playlist-read-collaborative,playlist-modify-public,playlist-modify-private
+
+# =============================================================================
+
+# FEATU=R=E=S
+
+# =============================================================================
+
+ENABLE_RECOMMENDATI=O=N=S=true
+
+ENABLE_PLAYLIST_CREAT=I=O=N=true
+
+ENABLE_USER_ANALYT=I=C=S=true
+
+ENABLE_CHAT_HIST=O=R=Y=true
+
+ENABLE_AI_FEATU=R=E=S=true
+
+ENABLE_VOICE_INTERF=A=C=E=true
+
+ENABLE_AUDIO_FEATU=R=E=S=true
+
+AUDIO_FEATURE_CACHE_=T=T=L=86400
+
+SPOTIFY_SEARCH_LI=M=I=T=50
+
+# =============================================================================
+
+# NOTIFICATI=O=N=S & ALE=R=T=S
+
+# =============================================================================
+
+SMTP_H=O=S=T=${SMTP_H=O=S=T:-smtp.gmail.com}
+
+SMTP_P=O=R=T=${SMTP_P=O=R=T:-587}
+
+SMTP_SEC=U=R=E=false
+
+SMTP_U=S=E=R=${SMTP_U=S=E=R:-}
+
+SMTP_P=A=S=S=${SMTP_P=A=S=S:-}
+
+FROM_EM=A=I=L=noreply@primosphere.studio
+
+ALERT_EM=A=I=L=admin@primosphere.studio
+
+SLACK_WEBH=O=O=K=${SLACK_WEBH=O=O=K:-}
+
+DISCORD_WEBH=O=O=K=${DISCORD_WEBH=O=O=K:-}
+
+# =============================================================================
+
+# DEVELOPM=E=N=T & DEBUGG=I=N=G
+
+# =============================================================================
+
+DE=B=U=G=false
+
+VERBOSE_LOGG=I=N=G=false
+
+ENABLE_PROFIL=I=N=G=false
+
+SOURCE_M=A=P=S=false
+
+HOT_REL=O=A=D=false
+
+MOCK_EXTERNAL_A=P=I=S=false
+
+BYPASS_A=U=T=H=false
+
+# =============================================================================
+
+# CONTAI=N=E=R & DEPLOYM=E=N=T
+
+# =============================================================================
+
+DOCKER_NETW=O=R=K=echotune-network
+
+CONTAINER_RESTART_POL=I=C=Y=unless-stopped
+
+CONTAINER_MEMORY_LI=M=I=T=1g
+
+CONTAINER_CPU_LI=M=I=T=1.0
+
+CLUSTER_M=O=D=E=false
+
+WORK=E=R=S=auto
+
+P=M=2_ENAB=L=E=D=false
+
+UPLOAD_MAX_S=I=Z=E=50mb
+
+UPLOAD_ALLOWED_TY=P=E=S=image/jpeg,image/png,audio/mpeg,audio/wav,application/json
+
+UPLOAD_P=A=T=H=/opt/echotune/uploads
+
+# =============================================================================
+
+# ADVAN=C=E=D SECUR=I=T=Y
+
+# =============================================================================
+
+SESSION_COOKIE_MAX_=A=G=E=86400000
+
+SESSION_COOKIE_SEC=U=R=E=true
+
+SESSION_COOKIE_HTTP_O=N=L=Y=true
+
+SESSION_COOKIE_SAME_S=I=T=E=strict
+
+API_KEY_HEA=D=E=R=X-A=P=I-K=ey
+
+JWT_EXPIRE=S_=I=N=24h
+
+JWT_REFRESH_EXPIRE=S_=I=N=7d
+
+BCRYPT_ROU=N=D=S=12
+
+USER_RATE_LIMIT_WINDO=W_=M=S=3600000
+
+USER_RATE_LIMIT_MAX_REQUE=S=T=S=1000
+
+IP_WHITEL=I=S=T=${IP_WHITEL=I=S=T:-}
+
+IP_BLACKL=I=S=T=${IP_BLACKL=I=S=T:-}
+
+# =============================================================================
+
+# BAC=K=U=P & MAINTENA=N=C=E
+
+# =============================================================================
+
+BACKUP_ENAB=L=E=D=true
+
+BACKUP_SCHED=U=L=E="0 2 * * *"
+
+BACKUP_RETENTION_D=A=Y=S=30
+
+BACKUP_COMPRESS=I=O=N=true
+
+BACKUP_P=A=T=H=/opt/echotune/backups
+
+REMOTE_BAC=K=U=P=false
+
+AW=S_=S=3_BUC=K=E=T=${AW=S_=S=3_BUC=K=E=T:-}
+
+AWS_REG=I=O=N=${AWS_REG=I=O=N:-us-east-1}
+
+AWS_ACCESS_KE=Y_=I=D=${AWS_ACCESS_KE=Y_=I=D:-}
+
+AWS_SECRET_ACCESS_=K=E=Y=${AWS_SECRET_ACCESS_=K=E=Y:-}
+
+MAINTENANCE_M=O=D=E=false
+
+MAINTENANCE_MESS=A=G=E="E=choT=une A=I is temporarily unavailable for maintenance. P=lease try again shortly."
+
+# =============================================================================
+
+# FEAT=U=R=E FL=A=G=S
+
+# =============================================================================
+
+FEATURE_C=H=A=T=true
+
+FEATURE_RECOMMENDATI=O=N=S=true
+
+FEATURE_PLAYLI=S=T=S=true
+
+FEATURE_ANALYT=I=C=S=true
+
+FEATURE_USER_PROFI=L=E=S=true
+
+FEATURE_VOICE_COMMA=N=D=S=false
+
+FEATURE_SOCIAL_SHAR=I=N=G=false
+
+FEATURE_COLLABORATIVE_PLAYLI=S=T=S=false
+
+FEATURE_MOOD_DETECT=I=O=N=false
+
+FEATURE_MULTI_LANGU=A=G=E=false
+
+AB_TESTING_ENAB=L=E=D=false
+
+AB_TEST_PERCENT=A=G=E=10
+
+# =============================================================================
+
+# P=W=A & MOB=I=L=E
+
+# =============================================================================
+
+PWA_ENAB=L=E=D=true
+
+PWA_N=A=M=E="E=choT=une A=I"
+
+PWA_SHORT_N=A=M=E="E=choT=une"
+
+PWA_DESCRIPT=I=O=N="A=I-P=owered M=usic D=iscovery P=latform"
+
+PWA_THEME_CO=L=O=R="#00d4aa"
+
+PWA_BACKGROUND_CO=L=O=R="#1a1a1a"
+
+MOBILE_OPTIMI=Z=E=D=true
+
+TOUCH_GESTU=R=E=S=true
+
+MOBILE_CACHE_S=I=Z=E=50mb
+
+# =============================================================================
+
+# U=I/U=X
+
+# =============================================================================
+
+DEFAULT_TH=E=M=E=dark
+
+ENABLE_THEME_SWITCH=I=N=G=true
+
+CUSTOM_BRAND=I=N=G=true
+
+ENABLE_ANIMATI=O=N=S=true
+
+ANIMATION_DURAT=I=O=N=300
+
+REDUCE_MOTION_SUPP=O=R=T=true
+
+LAZY_LOAD=I=N=G=true
+
+# =============================================================================
+
+# ANALYT=I=C=S & TRACK=I=N=G
+
+# =============================================================================
+
+USER_ANALYT=I=C=S=true
+
+ANONYMOUS_ANALYT=I=C=S=true
+
+GDPR_COMPLI=A=N=T=true
+
+COOKIE_CONS=E=N=T=true
+
+PERFORMANCE_TRACK=I=N=G=true
+
+ERROR_TRACK=I=N=G=true
+
+USER_BEHAVIOR_TRACK=I=N=G=false
+
+# =============================================================================
+
+# INTERNATIONALIZAT=I=O=N
+
+# =============================================================================
+
+DEFAULT_LOC=A=L=E=en-U=S
+
+SUPPORTED_LOCA=L=E=S=en-U=S,es-E=S,fr-F=R,de-D=E
+
+TIMEZ=O=N=E=U=T=C
+
+DATE_FOR=M=A=T=Y=Y=Y=Y-M=M-D=D
+
+TIME_FOR=M=A=T=H=H:mm:ss
+
+# =============================================================================
+
+# DIGITALOC=E=A=N
+
+# =============================================================================
+
+DIGITALOCEAN_TO=K=E=N=${DIGITALOCEAN_TO=K=E=N:-}
+
+DIGITALOCEAN_TOKEN_FALLB=A=C=K=${DIGITALOCEAN_TOKEN_FALLB=A=C=K:-}
+
+DO_REGISTRY_USERN=A=M=E=${DO_REGISTRY_USERN=A=M=E:-}
+
+DO_REGISTRY_TO=K=E=N=${DO_REGISTRY_TO=K=E=N:-}
+
+DO_APP_N=A=M=E=echotune-ai
+
+DO_REG=I=O=N=nyc1
+
+# O=A=uth callbacks
+
+OAUTH_CALLBACK_LO=C=A=L=http://localhost:3000/callback
+
+OAUTH_CALLBACK_PRODUCT=I=O=N=https://primosphere.studio/auth/callback
+MONGODB_U=R=I=mongodb+srv://copilot:D=apperM=an77@cluster0.ofnyuy.mongodb.net/echotune?retryW=rites=true&w=majority&appN=ame=C=luster0
+
+MONGODB_UR=I=mongodb+srv://copilot:D=apperM=an77@cluster0.ofnyuy.mongodb.net/echotune?retryW=rites=true&w=majority&appN=ame=C=luster0
+
EOF
)
