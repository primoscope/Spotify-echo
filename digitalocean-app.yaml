name: echotune-ai
services:
- name: web
  source_dir: /
  github:
    repo: dzp5103/Spotify-echo
    branch: main
    deploy_on_push: true
  run_command: npm start
  build_command: npm install && npm run build
  environment_slug: node-js
  instance_count: 1
  instance_size_slug: basic-xxs
  health_check:
    http_path: /api/health
    initial_delay_seconds: 30
    period_seconds: 10
    timeout_seconds: 5
    success_threshold: 1
    failure_threshold: 3
  routes:
  - path: /
  envs:
  # Core Application Settings
  - key: NODE_ENV
    value: production
  - key: PORT
    value: "3000"
  - key: FRONTEND_URL
    value: https://echotune-ai-${APP_ID}.ondigitalocean.app
  - key: DOMAIN
    value: echotune-ai-${APP_ID}.ondigitalocean.app
  
  # Database Configuration
  - key: MONGODB_URI
    value: ${MONGODB_URI}
    type: SECRET
  - key: REDIS_URL
    value: ${REDIS_URL}
    type: SECRET
  
  # Security (REQUIRED)
  - key: JWT_SECRET
    value: ${JWT_SECRET}
    type: SECRET
  - key: SESSION_SECRET
    value: ${SESSION_SECRET}
    type: SECRET
  
  # Spotify OAuth (REQUIRED for music features)
  - key: SPOTIFY_CLIENT_ID
    value: ${SPOTIFY_CLIENT_ID}
    type: SECRET
  - key: SPOTIFY_CLIENT_SECRET
    value: ${SPOTIFY_CLIENT_SECRET}
    type: SECRET
  - key: SPOTIFY_REDIRECT_URI
    value: https://echotune-ai-${APP_ID}.ondigitalocean.app/auth/callback
  
  # AI/LLM Providers (REQUIRED for chat and recommendations)
  - key: OPENAI_API_KEY
    value: ${OPENAI_API_KEY}
    type: SECRET
  - key: PERPLEXITY_API_KEY
    value: ${PERPLEXITY_API_KEY}
    type: SECRET
  - key: GOOGLE_API_KEY
    value: ${GOOGLE_API_KEY}
    type: SECRET
  - key: XAI_API_KEY
    value: ${XAI_API_KEY}
    type: SECRET
  
  # Browser Automation (Optional)
  - key: BROWSERBASE_API_KEY
    value: ${BROWSERBASE_API_KEY}
    type: SECRET
  - key: BROWSERBASE_PROJECT_ID
    value: ${BROWSERBASE_PROJECT_ID}
    type: SECRET
  
  # Workflow Automation (Optional)
  - key: N8N_API_URL
    value: ${N8N_API_URL}
    type: SECRET
  - key: N8N_API_KEY
    value: ${N8N_API_KEY}
    type: SECRET
  
  # Observability (Optional)
  - key: AGENTOPS_API_KEY
    value: ${AGENTOPS_API_KEY}
    type: SECRET
  - key: SENTRY_DSN
    value: ${SENTRY_DSN}
    type: SECRET
  
  # Rate Limiting and Security
  - key: RATE_LIMIT_WINDOW_MS
    value: "900000"
  - key: RATE_LIMIT_MAX_REQUESTS
    value: "100"
  - key: AUTH_RATE_LIMIT_MAX
    value: "5"
  - key: CORS_ORIGINS
    value: https://echotune-ai-${APP_ID}.ondigitalocean.app,https://localhost:3000
  - key: MAX_REQUEST_SIZE
    value: "10mb"
  - key: COMPRESSION
    value: "true"
  
  # Performance and Caching
  - key: CACHE_TTL
    value: "3600000"
  - key: REDIS_CACHE_TTL
    value: "1800000"
  - key: API_CACHE_TTL
    value: "300000"
  
  # Monitoring and Logging
  - key: LOG_LEVEL
    value: "info"
  - key: ENABLE_METRICS
    value: "true"
  - key: ENABLE_HEALTH_CHECKS
    value: "true"
  - key: ENABLE_PERFORMANCE_MONITORING
    value: "true"

# Database Service (Optional - if using DigitalOcean Managed Database)
- name: mongodb
  source_dir: /
  github:
    repo: dzp5103/Spotify-echo
    branch: main
  run_command: echo "MongoDB service placeholder - use managed database instead"
  environment_slug: node-js
  instance_count: 0
  instance_size_slug: basic-xxs
  envs:
  - key: NODE_ENV
    value: production

# Redis Service (Optional - if using DigitalOcean Managed Database)
- name: redis
  source_dir: /
  github:
    repo: dzp5103/Spotify-echo
    branch: main
  run_command: echo "Redis service placeholder - use managed database instead"
  environment_slug: node-js
  instance_count: 0
  instance_size_slug: basic-xxs
  envs:
  - key: NODE_ENV
    value: production

# Static Assets (Optional - for CDN)
- name: static-assets
  source_dir: dist
  github:
    repo: dzp5103/Spotify-echo
    branch: main
  run_command: echo "Static assets service - serves built frontend files"
  environment_slug: static
  instance_count: 1
  instance_size_slug: basic-xxs
  routes:
  - path: /assets
  envs:
  - key: NODE_ENV
    value: production

# Environment Variables Template
# Copy these to your DigitalOcean App Platform environment variables:
env_template: |
  # Required Environment Variables for DigitalOcean App Platform
  
  # Database
  MONGODB_URI=mongodb+srv://username:password@cluster.mongodb.net/database
  REDIS_URL=redis://username:password@host:port
  
  # Security
  JWT_SECRET=your_very_long_random_jwt_secret_key_here
  SESSION_SECRET=your_very_long_random_session_secret_key_here
  
  # Spotify
  SPOTIFY_CLIENT_ID=your_spotify_client_id_here
  SPOTIFY_CLIENT_SECRET=your_spotify_client_secret_here
  
  # AI Providers
  OPENAI_API_KEY=your_openai_api_key_here
  PERPLEXITY_API_KEY=your_perplexity_api_key_here
  GOOGLE_API_KEY=your_google_api_key_here
  XAI_API_KEY=your_xai_api_key_here
  
  # Optional Services
  BROWSERBASE_API_KEY=your_browserbase_api_key_here
  BROWSERBASE_PROJECT_ID=your_browserbase_project_id_here
  N8N_API_URL=your_n8n_api_url_here
  N8N_API_KEY=your_n8n_api_key_here
  AGENTOPS_API_KEY=your_agentops_api_key_here
  SENTRY_DSN=your_sentry_dsn_here